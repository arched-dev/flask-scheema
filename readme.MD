## 1. Introduction

This document describes the LBS Portal API. The LBS Portal API is a RESTful API that allows you to complete a variety of
tasks such as:

* Import orders into 365
* Manage order to pick
* Manage backorders
* Generate debtors letters

## 2. Authentication

The LBS Portal API uses json web tokens (JWT) for authentication. The JWT is passed in the Authorization header of each
request. The JWT is generated by the LBS Portal and is valid for 15 minutes. Once the expiry
has passed the JWT will no longer be valid and you will need to refresh it. To refresh the JWT you will need to make a
POST request to the /auth/refresh endpoint. The JWT is generated using the HS256 algorithm. Refresh tokens are valid for
10 Hours. Once the refresh token has expired, you will need to re-login.

## 3. Important Information

> - The API now handles serialisation in a custom marshmallow class.
> - Objects by default output 1 layer of children relationships on class all objects, to a maximum of 20 records.
> - All one to many child objects will be supplied with a `count` field to show the total number of records, and
    a `next_url` field to show the next page of records.
> -
> - Related routes can be automatically generated with the API spec decorator and a flag, marshmallow schemas must have
    a Meta.model attribute and not be `dump=True` for the route to generate.
> - `url_for` can be used to access these routes by passing "relations" blueprint name, the
    models `{tablename}_get_{relationship_name}` and the url of the route will
    be `relations/{parent_tablename}/<parent_pk>/{relation_name}`
> -
> - The API will just dump the API url for any relations over 1 level deep, one-to-one relationships are always dumped.
> -
> - Marshmallow schemas fields auto generates, and accept the following flags:
> -

* load_only (default False) - this is needed to avoid the generator picking up an incoming schema as a dump model)

> -

* API_SERIALIZATION_DEPTH (default 1) - sets the serialisation depth for the schema

> -

* API_SERIALIZE_ONE_TO_ONE (default True) - defines if the schema should always serialise one-to-one relationships

> -

* API_SERIALIZE_ONE_TO_MANY (default False) - defines if the schema should always serialise one-to-many relationships

> -

* API_DUMP_HYBRID_PROPERTIES (default True) - adds hybrid properties to the schema

>
> - API Joins now only work on the COMPUTED route. This is because there is no need to JOIN tables any more.
> - To filter by a joined table, you can use the `filter` parameter, and pass the table name and the field name,
    e.g. `filter=customer.name__like=John` and the api will handle the rest.
> -

## 3. Change Log

* 0.1.4
    * Added endpoints for Opera models, using a custom SQLAlchemy Dialect, this is untested on writing data, and while
      it uses the`oledb` driver, it should not be used for writing data to the database yet.
        * The custom Dialect does a hacky things currently and will need to be looked at if its used extensively.
          Firstly, it edits the query POST SQLAlchemy compilation with regex to fix any issues I couldn't do with
          SQLAlchemy right now.
    * Fixed the API Docs so the correct model is shown in the response output and the path parameters are correctly
      shown.
* 0.1.5
    * 25/09/2023 Changed the API to now accept many new functions. Aggregation, Grouping and Joining are all now
      possible which increases the power of the API.
    * 27/09/2023 Documentation updated with new features, examples and more. But have now lost the model information,
      which is being worked on.
